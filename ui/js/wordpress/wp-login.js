/**
 * Custom Login Functionality
 * 
 * @title      Login
 * @desc       Login functionality
 * @copyright  (c) 2020, Stephino
 * @author     Mark Jivko <stephino.team@gmail.com>
 * @package    stephino-rpg
 * @license    GPL v3+, gnu.org/licenses/gpl-3.0.txt
 */
/* global stephino_rpg_data, top, self */
// Stephino RPG: Login
jQuery && jQuery(document).ready(function() { var $ = jQuery, bodyObject = $('body'); $('<div data-role="stephino-version"></div>').html(`<a href="${stephino_rpg_data.wp_url}" target="_blank">Stephino RPG v. <b>${stephino_rpg_data.game_ver}</b></a>`).appendTo('body'); jQuery('#rememberme').prop('checked', true); $('a').each(function() { if ($(this).attr('href').match(/wp\-login\.php/g)) { var url = new URL($(this).attr('href')); url.searchParams.set('redirect_to', stephino_rpg_data.ajax_url); url.searchParams.set('stephino-rpg-login', 1); $(this).attr('href', url.toString()); } }); $('form').each(function() { var url = new URL($(this).attr('action')); url.searchParams.set('redirect_to', stephino_rpg_data.ajax_url); url.searchParams.set('stephino-rpg-login', 1); $(this).attr('action', url.toString()); }); var messageHolder = $('<div data-role="stephino-message-holder"></div>').appendTo('body'); if ($('#login .message').length) { window.setTimeout(function() { messageHolder.find('.message').slideUp(); }, 5000); } $('#login #login_error').click(function(e) { $(this).slideUp(); }); $('#login .message a, #login #login_error a, .privacy-policy-link').attr('target', '_blank'); $('#login .message, #login #login_error').detach().appendTo(messageHolder); $('#backtoblog, #login h1, .clear, #reg_passmail').remove(); ['circle', 'char', 'title'].forEach(function(value) { var content = ''; if ('title' === value) { content = stephino_rpg_data.is_pro ? `${stephino_rpg_data.game_name} <span>${stephino_rpg_data.game_desc}</span>` : 'Stephino RPG' } bodyObject.append(`<div data-role="stephino-login-${value}">${content}</div>`); }); var blobPath = 'M39.1,-50.4C49.1,-38.2,54.6,-24.4,53.1,-12.4C51.6,-0.4,43.2,9.8,38.2,25.3C33.1,40.8,31.5,61.5,22.1,68.1C12.7,74.7,-4.6,67.3,-23.9,61.9C-43.3,56.5,-64.8,53.2,-75.4,40.7C-85.9,28.2,-85.5,6.6,-74.2,-5.3C-62.8,-17.2,-40.5,-19.4,-26.3,-31C-12.1,-42.5,-6.1,-63.4,4.2,-68.4C14.5,-73.5,29.1,-62.7,39.1,-50.4Z'; bodyObject.append(`<div data-role="stephino-login-blob-separator"><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><path fill="#ff0066" d="${blobPath}" transform="translate(100 100)" /></svg></div>`); window.setTimeout(function() { bodyObject.addClass('ready'); }, 250); $('input[type="button"], input[type="submit"]').each(function() { var replacement = $('<button class="st-btn"><div><span></span><span></span><span class="st-btn-txt"></span></div></button>'); replacement.find('.st-btn-txt').html($(this).val()); $(this).replaceWith(replacement); }); try { if (top.location.host === self.location.host) { $('div.nsl-container-block .nsl-container-buttons a').each(function() { var provider = $(this).attr('data-provider'); var providerCapitalized = provider.charAt(0).toUpperCase() + provider.slice(1); $(this).find('.nsl-button-label-container').html(providerCapitalized); }); $('#nsl-custom-login-form-main').prepend(`<div data-role="stephino-social-separator">${stephino_rpg_data.i18n.label_or}</div>`); } else { throw '[stephino-rpg-login] Not the same host'; } } catch (e) { var fallbackUrl = self.location.href; var fallbackTarget = '_blank'; try { fallbackUrl = parent.location.href; fallbackTarget = '_top'; } catch (ef) {} var loginButton = $('<a class="st-btn"><div><span></span><span></span><span class="st-btn-txt"></span></div></a>'); loginButton .attr('href', fallbackUrl) .attr('target', fallbackTarget) .find('.st-btn-txt').html(stephino_rpg_data.i18n.label_log_in); $('#login').html('').append(loginButton); }});